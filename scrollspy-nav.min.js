class ScrollSpyNav extends HTMLElement{constructor(){super();this.duration=200;this.ease='cubic-bezier(0.25, 1, 0.5, 1)';this.links=this.querySelectorAll('a');this.observerOptions={};this.sections=[]}connectedCallback(){this.getSections();this.getObserverOptions();this.setCSSCustomProps();this.handleSmoothScrollOnClick();document.addEventListener('readystatechange',e=>e.target.readyState=='complete'&&(this.setObserver(),this.createMarker()))}adjustMenuPosition(a){var b=a.getBoundingClientRect(),c=parseFloat(this.getProp('padding-inline-start')),d=~~b.left-c<0,e=~~b.right+c>this.offsetWidth;if(!d&&!e)return;let f;d?f=this.scrollLeft-c+b.left:e&&(f=this.scrollLeft+c+b.right-this.offsetWidth);this.setMenuScrollPosition(f)}animateMarker(a){var b=a.getBoundingClientRect(),c=this.activeLink?.getBoundingClientRect()||b,d=c.left-b.left,e=window.matchMedia('(prefers-reduced-motion: reduce)').matches;a.after(this.marker);this.setActiveLink(a);this.marker.animate([{transform:`translateX(${d}px) scaleX(${c.width})`},{transform:`translateX(0) scaleX(${b.width})`}],{duration:e?0:this.duration,easing:this.ease,fill:'forwards'})}createMarker(){var a=document.createElement('div');a.setAttribute('data-marker','');this.marker=a}getObserverOptions(){var b=this.getAttribute('observer-root-margin'),c=this.getAttribute('observer-threshold');this.observerOptions={root:document.querySelector(this.getAttribute('observer-root')),rootMargin:b||'-25% 0% -75% 0%',threshold:+c}}getProp(a){return getComputedStyle(this).getPropertyValue(a)}getSections(){for(const a of this.links){if(new URL(a.href).host!==window.location.host)return;var A=document.querySelector(a.hash),b=a.hash.substring(1);if(!A){console.warn(`${this.constructor.name}: Element with id "${b}" doesn't exist on this page.`);return}this.sections.push(A)}}handleSmoothScrollOnClick(){var a=()=>{if(this.observer)return;this.setObserver()};this.addEventListener('click',()=>{if(!this.observer)return;this.observer.disconnect();this.observer=null});'onscrollend' in window?document.addEventListener('scrollend',a):document.addEventListener('scroll',()=>{clearTimeout(this.scrollEndTimer);this.scrollEndTimer=setTimeout(a,100)})}setActiveLink(a){this.activeLink?.removeAttribute('aria-current');a.setAttribute('aria-current','true');this.activeLink=a}setCSSCustomProps(){this.setDuration();this.setEasing()}setDuration(){var a=this.getProp('--scrollspy-nav-marker-duration'),b=a.split(/\d+/g).pop();if(!a)return;this.duration=b=='s'?parseInt(a)*1000:parseInt(a)}setEasing(){var a=this.getProp('--scrollspy-nav-marker-ease');if(!a)return;this.ease=a}setObserver(){var a=(A=>{for(const _ of A){if(!_.isIntersecting)continue;const b=this.querySelector(`[href="#${_.target.id}"`);this.animateMarker(b);this.adjustMenuPosition(b)}!this.activeLink&&this.animateMarker(this.links[0])});this.observer=new IntersectionObserver(a, this.observerOptions);for(const A of this.sections)this.observer.observe(A)}setMenuScrollPosition(a){this.scrollTo({left:a,behavior:'smooth'})}}window!==void 0&&'customElements' in window&&window.customElements.define('scrollspy-nav',ScrollSpyNav);
