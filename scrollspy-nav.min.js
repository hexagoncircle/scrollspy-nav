class ScrollSpyNav extends HTMLElement{constructor(){super();this.links=this.querySelectorAll('a');this.sectionIds=[...this.links].map(el=>this.getLinkHashValue(el));this.observerOptions={};this.scrollDirection='up';this.prevScrollPos=0;this.duration=200;this.ease='cubic-bezier(0.25, 1, 0.5, 1)'}connectedCallback(){document.fonts.ready.then(()=>{this.getObserverOptions();this.setObserver();this.setCSSCustomProps();this.createMarker();this.handleSmoothScrollOnClick()})}adjustMenuPosition(a){var b=a.getBoundingClientRect(),c=parseFloat(getComputedStyle(this).getPropertyValue('padding-inline-start')),d=~~b.left+c<0,e=~~b.right+c>this.offsetWidth;if(!d&&!e)return;d?this.setScrollMenuPosition(this.scrollLeft-c+b.left):e&&this.setScrollMenuPosition(this.scrollLeft+c+b.right-this.offsetWidth)}animateMarker(a){var b=a.getBoundingClientRect(),c=this.activeLink?.getBoundingClientRect()||b,d=c.left-b.left,e=window.matchMedia('(prefers-reduced-motion: reduce)').matches;a.after(this.marker);this.setActiveLink(a);this.marker.animate([{transform:`translateX(${d}px) scaleX(${c.width})`},{transform:`translateX(0) scaleX(${b.width})`}],{duration:e?0:this.duration,easing:this.ease,fill:'forwards'})}createMarker(){var a=document.createElement('div');a.setAttribute('data-marker','');this.marker=a}getLinkHashValue(a){return a.hash.substring(1)}getObserverOptions(){var b=this.getAttribute('observer-root-margin'),c=this.getAttribute('observer-threshold');this.observerOptions={root:document.querySelector(this.getAttribute('observer-root')),rootMargin:b||'-25% 0% -75% 0%',threshold:+c}}getTargetSection(a){if(this.scrollDirection=='up')return a;if(a.nextElementSibling)return a.nextElementSibling;return a}handleSmoothScrollOnClick(){var a=()=>{if(this.observer)return;this.setObserver()};this.addEventListener('click',()=>{if(!this.observer)return;this.observer.disconnect();this.observer=null});'onscrollend' in window?document.addEventListener('scrollend',a):document.addEventListener('scroll',()=>{clearTimeout(this.scrollEndTimer);this.scrollEndTimer=setTimeout(a,100)})}setCSSCustomProps(){this.setDuration();this.setEasing()}setDuration(){var a=getComputedStyle(this).getPropertyValue('--scrollspy-nav-marker-duration'),b=a.split(/\d+/g).pop();if(!a)return;this.duration=b=='s'?parseInt(a)*1000:parseInt(a)}setEasing(){var a=getComputedStyle(this).getPropertyValue('--scrollspy-nav-marker-ease');if(!a)return;this.ease=a}setScrollDirection(){window.scrollTop>this.prevScrollPos?this.scrollDirection='down':this.scrollDirection='up';this.prevScrollPos=window.scrollTop}setObserver(){var a=(A=>{for(const _ of A){this.setScrollDirection();if(!this.shouldUpdate(_))continue;const B=this.getTargetSection(this.querySelector(`[href="#${_.target.id}"`));this.animateMarker(B);this.adjustMenuPosition(B)}!this.activeLink&&this.animateMarker(this.links[0])});this.observer=new IntersectionObserver(a, this.observerOptions);for(const A of this.sectionIds)this.observer.observe(document.getElementById(A))}setActiveLink(a){this.activeLink?.removeAttribute('aria-current');a.setAttribute('aria-current','true');this.activeLink=a}setScrollMenuPosition(a){this.scrollTo({left:a,behavior:'smooth'})}shouldUpdate(a){if(this.scrollDirection=='down'&&!a.isIntersecting)return!0;if(this.scrollDirection=='up'&&a.isIntersecting)return!0;return!1}}window!==void 0&&'customElements' in window&&window.customElements.define('scrollspy-nav',ScrollSpyNav);
